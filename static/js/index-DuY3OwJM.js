var ce=Object.defineProperty,pe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var te=(u,l,i)=>l in u?ce(u,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[l]=i,K=(u,l)=>{for(var i in l||(l={}))_e.call(l,i)&&te(u,i,l[i]);if(ee)for(var i of ee(l))fe.call(l,i)&&te(u,i,l[i]);return u},W=(u,l)=>pe(u,me(l));import{d as D,B as ne,c as Q,r as m,o as p,a as O,w as s,b as r,e as t,f as k,t as N,g as E,_ as z,k as V,Z as ye,$ as J,i as R,a0 as ve,x as ge,n as be,u as _,G as T,F as U,l as X,a1 as le,a2 as Y,N as re,a3 as ke,s as ue,v as ie,h as Z,j as he,C as ae,W as Ve,M as oe,V as Ce,a4 as se,a5 as Se,a6 as Te,T as we,a7 as qe,a8 as Oe,z as B,a9 as xe,aa as Me,ab as Ie,ac as $e,ad as Ee,ae as Ue}from"./index-Dxllzmhq.js";import{S as Ne}from"./index-D0yvvg8b.js";const De={class:"EditortSuccess"},ze={class:"btn-box"},Le=D({__name:"EditortSuccess",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"模板提交成功"}},emits:["update:modelValue"],setup(u,{emit:l}){const i=l;let C=ne();const e=u,f=Q({get(){return e.modelValue},set(){i("update:modelValue",!1)}});function x(){C.query.editorType=="is_data"?E.push({name:"userTemplate"}):E.push({name:"userTemplateFragments"})}return(v,d)=>{const o=m("CircleCheckFilled"),g=m("el-icon"),y=m("el-button"),S=m("el-dialog");return p(),O(S,{modal:"","close-on-click-modal":!1,style:{"border-radius":"8px"},"custom-class":"customClass",top:"33vh",modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=w=>f.value=w),width:"396","destroy-on-close":""},{default:s(()=>[r("div",De,[t(g,null,{default:s(()=>[t(o)]),_:1}),k(" "+N(e.title)+" ",1),r("div",ze,[t(y,{class:"btn",size:"large",onClick:d[0]||(d[0]=w=>f.value=!1)},{default:s(()=>[k(" 取消 ")]),_:1}),t(y,{type:"primary",class:"btn",size:"large",onClick:x},{default:s(()=>[k(" 去查看 ")]),_:1})])])]),_:1},8,["modelValue"])}}}),je=z(Le,[["__scopeId","data-v-b96d3871"]]),Be={class:"EditorHeader"},Fe=D({__name:"EditorHeader",props:{title:{default:""}},setup(u){const{title:l}=u;return(i,C)=>(p(),V("div",Be,[ye(i.$slots,"default",{},()=>[k(N(l))],!0)]))}}),F=z(Fe,[["__scopeId","data-v-c5f914da"]]),Re={class:"tree"},Je=D({__name:"Editortree",setup(u){const l=J("ediotrConfig"),i=R([]);ve(J("ediotrConfig"),()=>{i.value=[],be(()=>{i.value=l})},{deep:!0,immediate:!0});const C=f=>{console.log(f)},e={children:"childern",label:f=>f.style?f.style.name||"无名字":f.label};return(f,x)=>{const v=m("el-tree");return p(),V("div",Re,[t(v,{style:{"max-width":"600px"},data:i.value,"node-key":"id",props:e,onNodeClick:C},{default:s(({node:d,data:o})=>[r("div",null,[r("span",{class:ge(["custom-tree-node",{node:o.childern.length>0}])},N(d.label),3)])]),_:1},8,["data"])])}}}),Ae=z(Je,[["__scopeId","data-v-e7210943"]]),He=u=>(ue("data-v-ff884d1e"),u=u(),ie(),u),Pe={key:0,class:"EditorLeftSet"},Ge=He(()=>r("div",{class:"tips"},":",-1)),Ke=D({__name:"EditorLeftSet",setup(u){const l=J("ediotrCurrent"),i=J("ediotrConfig"),C=Q(()=>Y.componentList.filter(d=>d.key!=="array")),e=Q({get(){let d=(l==null?void 0:l.style)||{name:"",unit:"",multi:!1,required:!0,type:"",attribute:0,dataOption:[]},o=le(i,(l==null?void 0:l.id)||"");return new Proxy(d,{set(g,y,S){return console.log("chufa"),g[y]=S,l.style=d,o.current.style=d,!0}})},set(){console.log("set")}});function f(d){let o=le(i,(l==null?void 0:l.id)||"");o.current.childern.splice(0,o.current.childern.length);let g=W(K({},Y.componentMap[d]),{id:re(20),isArray:!0,childern:[],style:{name:"",unit:"",multi:!1,required:!0,type:"",attribute:0,dataOption:[]},group:{name:"module",pull:!1,put:!0}});Object.assign(o.current.childern,[ke(g)])}function x(){let d=e.value.dataOption;d.push(""),d=JSON.parse(JSON.stringify(d)),e.value.dataOption=d}function v(d){e.value.dataOption.splice(d,1)}return(d,o)=>{const g=m("el-input"),y=m("el-form-item"),S=m("el-switch"),w=m("el-radio"),A=m("el-radio-group"),q=m("el-option"),M=m("el-select"),L=m("CircleClose"),H=m("el-icon"),P=m("el-button"),G=m("el-form");return JSON.stringify(_(l))!="{}"?(p(),V("div",Pe,[t(G,{ref:"ediotrCurrentRef",model:e.value,size:"large","label-width":"auto",class:"demo-ediotrCurrent"},{default:s(()=>[t(y,{prop:"password",label:"字段类型"},{default:s(()=>[t(g,{modelValue:_(l).label,"onUpdate:modelValue":o[0]||(o[0]=c=>_(l).label=c),modelModifiers:{trim:!0},placeholder:"字段类型",disabled:""},null,8,["modelValue"])]),_:1}),Object.prototype.hasOwnProperty.call(_(l),"isArray")&&_(l).isArray?T("",!0):(p(),O(y,{key:0,prop:"password",label:"字段名称"},{default:s(()=>[t(g,{modelValue:e.value.name,"onUpdate:modelValue":o[1]||(o[1]=c=>e.value.name=c),modelModifiers:{trim:!0},placeholder:"字段名称"},null,8,["modelValue"])]),_:1})),_(l).key=="update_img"?(p(),O(y,{key:1,prop:"password",label:"允许多张图片"},{default:s(()=>[t(S,{modelValue:e.value.multi,"onUpdate:modelValue":o[2]||(o[2]=c=>e.value.multi=c)},null,8,["modelValue"])]),_:1})):T("",!0),_(l).key=="number"?(p(),O(y,{key:2,prop:"password",label:"单位"},{default:s(()=>[t(g,{modelValue:e.value.unit,"onUpdate:modelValue":o[3]||(o[3]=c=>e.value.unit=c),modelModifiers:{trim:!0},placeholder:"字段名称"},null,8,["modelValue"])]),_:1})):T("",!0),_(l).key=="update_file"?(p(),O(y,{key:3,prop:"password",label:"允许多份文件"},{default:s(()=>[t(S,{modelValue:e.value.multi,"onUpdate:modelValue":o[4]||(o[4]=c=>e.value.multi=c),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):T("",!0),_(l).key=="range"?(p(),V(U,{key:4},[t(y,{prop:"password",label:"单位"},{default:s(()=>[t(g,{modelValue:e.value.unit,"onUpdate:modelValue":o[5]||(o[5]=c=>e.value.unit=c),modelModifiers:{trim:!0},placeholder:"单位"},null,8,["modelValue"])]),_:1}),t(y,{prop:"password",label:"类型"},{default:s(()=>[t(A,{modelValue:e.value.attribute,"onUpdate:modelValue":o[6]||(o[6]=c=>e.value.attribute=c),class:"ml-4"},{default:s(()=>[t(w,{value:0},{default:s(()=>[k("范围")]),_:1}),t(w,{value:1},{default:s(()=>[k("误差")]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)):T("",!0),_(l).key=="array"?(p(),O(y,{key:5,prop:"password",label:"选择器"},{default:s(()=>[t(M,{filterable:"",modelValue:e.value.type,"onUpdate:modelValue":o[7]||(o[7]=c=>e.value.type=c),placeholder:"选择器",onChange:f},{default:s(()=>[(p(!0),V(U,null,X(C.value,c=>(p(),O(q,{label:c.label,value:c.key,key:c.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),_(l).key=="select"?(p(),O(y,{key:6,prop:"password",label:" "},{default:s(()=>[(p(!0),V(U,null,X(e.value.dataOption,(c,I)=>(p(),V("div",{key:I,class:"flex"},[Ge,t(g,{modelValue:e.value.dataOption[I],"onUpdate:modelValue":n=>e.value.dataOption[I]=n,modelModifiers:{trim:!0},size:"small",class:"mb-10"},null,8,["modelValue","onUpdate:modelValue"]),t(H,{onClick:n=>v(I)},{default:s(()=>[t(L)]),_:2},1032,["onClick"])]))),128)),t(P,{link:"",type:"primary",onClick:x},{default:s(()=>[k("添加选项")]),_:1})]),_:1})):T("",!0),t(y,{prop:"password",label:"是否必填"},{default:s(()=>[t(S,{modelValue:e.value.required,"onUpdate:modelValue":o[8]||(o[8]=c=>e.value.required=c)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):T("",!0)}}}),We=z(Ke,[["__scopeId","data-v-ff884d1e"]]),Ze=[],Qe=[],Xe={blocks:Ze,style:Qe},de=u=>(ue("data-v-e026ca8b"),u=u(),ie(),u),Ye={class:"templateManage"},et={class:"templateManage_header"},tt={class:"templateManage_header_title"},lt={class:"templateManage_header_title_left"},at={class:"editor_center topCenter"},ot={class:"editor_center_left"},st={class:"editor_center_left_control"},nt=["data-type","data-key"],rt={class:"editor_center_left_set"},ut=de(()=>r("div",{class:"header_header_left"},[r("span",null,"表单设计"),r("span",null," 将控件拖入下方面板中，同级别控件可通过长按鼠标拖拽进行顺序调整 ")],-1)),it={class:"editor_center_form_drag_box"},dt={key:0,class:"ArrayLayout-tips"},ct=de(()=>r("p",null,"将控件拖入此区域",-1)),pt={class:"editor_center_right"},mt=D({__name:"index",setup(u){var I;const{on:l,emit:i}=qe(),C=Z({name:"module",pull:!1,put:!0}),e=ne();he(()=>{e.query.editorType=="is_data"?A(e.query.templateId||e.query.id):w(e.query.templateId||e.query.id)});const f=R(!1),x=(I=Y)==null?void 0:I.componentTypeMap,v=Z(JSON.parse(JSON.stringify(Xe))),d=Z({});ae("ediotrConfig",v.blocks),ae("ediotrCurrent",d);function o(n){return W(K({},n),{id:re(20),state:0,childern:[],style:null,group:{name:"module",pull:!1,put:!0}})}l("closeDraggable",n=>{S(n,!1)});const g=()=>{i("DraggableState",!0)},y=()=>{i("DraggableState",!1),Oe(v.blocks)};function S(n=!0,a=!0){a?setTimeout(()=>{Object.assign(C,{name:"module",pull:!1,put:n})},200):Object.assign(C,{name:"module",pull:!1,put:n})}function w(n){n&&Ve(n).then(a=>{let h=oe(a.data.content,!1);v.blocks.splice(1,0,...h),f.value=!1})}function A(n){n&&Ce(n).then(a=>{a.data.has_data,e.query.templateId;let h=oe(a.data.content,a.data.has_data||!1);v.blocks.splice(0,v.blocks.length,...h)})}const q=R(!1),M=R("");function L(n){let a=JSON.parse(decodeURIComponent(e.query.basicData));console.log(a,JSON.parse(decodeURIComponent(e.query.basicData))),a.published=n,a.category=Number(a.category);let h={_ord:[]};if(v.blocks.length==0){B.error("请添加表单组件");return}let $=xe(v.blocks);if($===1){B.error("请填写表单项名称");return}if($===2){B.error("表单项名称存在重复值");return}if($===3){B.error("数组类型必须选择表单项");return}a.content=Me(v.blocks,h,"_ord"),console.log(a.content),e.query.editorType=="is_data"?H(a):P(a)}function H(n){e.query.id?Ie(e.query.id,n).then(a=>{M.value="模板修改成功",q.value=!0}):$e(n).then(a=>{M.value="模板提交成功",q.value=!0})}function P(n){n.snippet_name=n.title,e.query.id?Ee(e.query.id,n).then(()=>{M.value="模板片段修改成功",q.value=!0}):Ue(n).then(a=>{M.value="模板片段提交成功",q.value=!0})}function G(){e.query.id?E.go(-1):E.replace({name:"createTemplateManage",query:{basicData:e.query.basicData,type:e.query.editorType}})}function c(){E.push("/userInfo/userTemplate")}return(n,a)=>{const h=m("el-button"),$=m("svg-icon");return p(),V(U,null,[r("div",Ye,[r("div",et,[r("div",tt,[r("div",lt,N(_(e).query.id?_(e).query.editorType=="is_data"?"修改模板":"修改模板片段":"创建模板"),1),r("div",null,[t(Ne,{index:2})]),r("div",null,[t(h,{type:"primary",class:"btn",size:"large",onClick:a[0]||(a[0]=b=>f.value=!0)},{default:s(()=>[k(" 导入模板片段 ")]),_:1}),t(h,{class:"btn",size:"large",onClick:G},{default:s(()=>[k(" 上一步 ")]),_:1}),t(h,{class:"btn",size:"large",onClick:a[1]||(a[1]=b=>L(!1))},{default:s(()=>[k(" 暂存 ")]),_:1}),t(h,{type:"primary",class:"btn",size:"large",onClick:a[2]||(a[2]=b=>L(!0))},{default:s(()=>[k(" 提交 ")]),_:1}),t(h,{class:"btn",size:"large",onClick:c},{default:s(()=>[k("取消")]),_:1})])])]),r("div",at,[r("div",ot,[r("div",st,[t(F,{title:"数据类型"}),(p(!0),V(U,null,X(Object.keys(_(x)),(b,_t)=>(p(),V("div",{key:b},[t(_(se),{class:"componentTypeMap",list:_(x)[b],"item-key":"index",group:{name:"module",pull:"clone",put:!1},clone:o,sort:!1,onStart:g,onEnd:y,animation:"300"},{item:s(({element:j})=>[r("div",{class:"item","data-type":j.type,"data-key":j.key},[r("div",null,[t($,{name:j.icon,width:"40px",height:"40px"},null,8,["name"])]),r("p",null,N(j.label),1)],8,nt)]),_:2},1032,["list"])]))),128))]),r("div",rt,[t(F,{title:"字段设置"}),t(We)])]),r("div",{class:"editor_center_form",onDragenter:a[3]||(a[3]=Se(b=>S(!0,!0),["stop"]))},[t(F,{title:"表单设计",class:"leftHeader"},{default:s(()=>[ut]),_:1}),r("div",it,[t(_(se),{group:C,class:"editor_center_form_drag",list:v.blocks,"ghost-class":"ghost",itemKey:"id","chosen-class":"chosenClass",animation:"300"},{item:s(({element:b})=>[t(_(Te),{blocks:b},null,8,["blocks"])]),_:1},8,["group","list"]),v.blocks.length===0?(p(),V("div",dt,[t($,{name:"drag"}),ct])):T("",!0)])],32),r("div",pt,[t(F,{title:"模板大纲"}),t(Ae)])])]),t(we,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=b=>f.value=b),onSelectTemplate:w},null,8,["modelValue"]),t(je,{modelValue:q.value,"onUpdate:modelValue":a[5]||(a[5]=b=>q.value=b),title:M.value},null,8,["modelValue","title"])],64)}}}),gt=z(mt,[["__scopeId","data-v-e026ca8b"]]);export{gt as default};
