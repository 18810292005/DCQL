var v=(l,r,i)=>new Promise((c,C)=>{var w=u=>{try{b(i.next(u))}catch(p){C(p)}},y=u=>{try{b(i.throw(u))}catch(p){C(p)}},b=u=>u.done?c(u.value):Promise.resolve(u.value).then(w,y);b((i=i.apply(l,r)).next())});import{ai as h,d as Z,i as d,j as ee,h as L,r as m,X as te,o as N,k as ae,e,w as a,f as _,u as le,ao as se,H as oe,a as E,b as g,t as ne,G as ie,au as A,z as M,s as re,v as ce,_ as de}from"./index-Dxllzmhq.js";const ue=l=>h.get("/api/storage/categories/?query="+l),pe=l=>h.post("/api/storage/categories/",l),me=(l,r)=>h.patch("/api/storage/categories/"+l+"/",{name:r}),fe=l=>h.patch("/api/storage/categories/",l),_e=(l,r)=>{const i={version:r};return h.delete("/api/storage/categories/"+l+"/",{data:i})},ve=l=>(re("data-v-406a09e1"),l=l(),ce(),l),ge={class:"classificationManagement leftTable"},ye=ve(()=>g("div",{class:"classificationManagement-title pl_20"},[g("div",{class:"border4"}),g("div",{class:"title"},"分类管理")],-1)),ke={class:"tree-content-style"},be={style:{width:"200px"}},he={class:"dialog-footer"},Ce=Z({name:"classificationManagement",__name:"index",setup(l){const r=d(),i=d(!1),c=()=>v(this,null,function*(){i.value=!0;let t=yield ue(y.query);t.code===0?(i.value=!1,o.version=t.data.version,r.value=t.data.children):i.value=!1}),C=()=>{A.confirm("确定要移动该分类吗？","移动数据",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>v(this,null,function*(){(yield fe({version:o.version,children:r.value})).code===0&&(M({type:"success",message:"移动成功"}),c())})).catch(()=>{c()})};ee(()=>{c()});const w=d(),y=L({query:""}),b=()=>{c()},u=t=>{t&&(t.resetFields(),c())},p=d(!1),x=d(""),D=d(""),V=d(""),O=()=>{x.value="添加分类",V.value="分类名称",p.value=!1,B.value=!0,k.value=!0},k=d(!1),j=()=>{},q=()=>{F.value.resetFields(),k.value=!1},G=t=>v(this,null,function*(){t&&t.validate(s=>v(this,null,function*(){s&&(B.value?(p.value||delete o.parent_id,(yield pe(o)).code===0&&(M({type:"success",message:"添加成功"}),q(),c())):(yield me(o.parent_id,o.name)).code===0&&(M({type:"success",message:"重命名成功"}),q(),c()))}))}),B=d(!0),H=t=>{console.log(t),x.value="添加分类",D.value="父级分类名称",V.value="分类名称",o.parent_id=t.data.id,p.value=!0,B.value=!0,k.value=!0},P=t=>{x.value="修改分类名称",D.value="分类名称",V.value="重命名",B.value=!1,o.parent_id=t.data.id,p.value=!0,k.value=!0},F=d(),o=L({parent_id:void 0,name:"",version:""}),Q=L({name:[{required:!0,message:"分类名称不能为空",trigger:"blur"}]}),U={children:"children",label:"name"},X=t=>v(this,null,function*(){A.confirm("确定要删除该分类吗？","删除数据",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>v(this,null,function*(){(yield _e(t.data.id,o.version)).code===0&&(M({type:"success",message:"删除成功"}),c())}))});return(t,s)=>{const T=m("el-divider"),$=m("el-input"),z=m("el-form-item"),f=m("el-button"),I=m("el-form"),S=m("el-table-column"),J=m("el-tree"),K=m("el-tree-select"),W=m("el-dialog"),Y=te("loading");return N(),ae("div",ge,[ye,e(T,{class:"bt_40"}),e(I,{ref_key:"conditionFormRef",ref:w,model:y,inline:!0,"label-width":"0",size:"large"},{default:a(()=>[e(z,{label:"",prop:"query"},{default:a(()=>[e($,{modelValue:y.query,"onUpdate:modelValue":s[0]||(s[0]=n=>y.query=n),modelModifiers:{trim:!0},placeholder:"输入分类名称",style:{width:"283px"},clearable:""},null,8,["modelValue"])]),_:1}),e(z,{label:""},{default:a(()=>[e(f,{type:"primary",onClick:b},{default:a(()=>[_("查询")]),_:1}),e(f,{onClick:s[1]||(s[1]=n=>u(w.value))},{default:a(()=>[_("重置")]),_:1}),e(f,{plain:"",type:"primary",onClick:O},{default:a(()=>[_("新增")]),_:1})]),_:1})]),_:1},8,["model"]),e(le(se),{style:{width:"100%"}},{default:a(()=>[e(S,{label:"分类名称",width:"200",align:"center"}),e(S,{align:"center"}),e(S,{label:"操作",width:"200",fixed:"right",align:"center"})]),_:1}),oe((N(),E(J,{data:r.value,props:U,"node-key":"id",draggable:"","expand-on-click-node":!1,onNodeDrop:C},{default:a(({node:n,data:we})=>[g("div",ke,[g("div",null,ne(n.label),1),g("div",be,[e(f,{link:"",type:"primary",size:"small",onClick:R=>H(n)},{default:a(()=>[_(" 添加子分类 ")]),_:2},1032,["onClick"]),e(f,{link:"",type:"primary",size:"small",onClick:R=>P(n)},{default:a(()=>[_(" 编辑 ")]),_:2},1032,["onClick"]),e(f,{link:"",type:"danger",size:"small",onClick:R=>X(n)},{default:a(()=>[_(" 删除 ")]),_:2},1032,["onClick"])])])]),_:1},8,["data"])),[[Y,i.value]]),e(W,{modal:"","close-on-click-modal":!1,modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=n=>k.value=n),title:x.value,width:"900","align-center":"","destroy-on-close":"",onClose:q,onOpen:j},{footer:a(()=>[g("div",he,[e(f,{onClick:q,size:"large"},{default:a(()=>[_("取消")]),_:1}),e(f,{size:"large",type:"primary",onClick:s[4]||(s[4]=n=>G(F.value))},{default:a(()=>[_(" 确定 ")]),_:1})])]),default:a(()=>[e(I,{ref_key:"classificationFormRef",ref:F,style:{"max-width":"900px"},model:o,"status-icon":"",rules:Q,"label-width":"auto",size:"large"},{default:a(()=>[p.value?(N(),E(z,{key:0,label:D.value,prop:""},{default:a(()=>[e(K,{filterable:"",modelValue:o.parent_id,"onUpdate:modelValue":s[2]||(s[2]=n=>o.parent_id=n),data:r.value,props:U,"node-key":"id","check-on-click-node":"","check-strictly":"",disabled:""},null,8,["modelValue","data"])]),_:1},8,["label"])):ie("",!0),e(z,{label:V.value,prop:"name"},{default:a(()=>[e($,{modelValue:o.name,"onUpdate:modelValue":s[3]||(s[3]=n=>o.name=n),modelModifiers:{trim:!0},placeholder:"输入分类名称",clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),qe=de(Ce,[["__scopeId","data-v-406a09e1"]]);export{qe as default};
