var $e=Object.defineProperty;var le=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var te=(c,d,n)=>d in c?$e(c,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[d]=n,ae=(c,d)=>{for(var n in d||(d={}))Ee.call(d,n)&&te(c,n,d[n]);if(le)for(var n of le(d))Je.call(d,n)&&te(c,n,d[n]);return c};var y=(c,d,n)=>new Promise((V,x)=>{var D=f=>{try{m(n.next(f))}catch(S){x(S)}},_=f=>{try{m(n.throw(f))}catch(S){x(S)}},m=f=>f.done?V(f.value):Promise.resolve(f.value).then(D,_);m((n=n.apply(c,d)).next())});import{r as Re,a as Xe}from"./index-11tLsVUs.js";import{v as oe,r as je}from"./setData-BXCfuNPN.js";import{d as Ie,i as s,h as ne,j as Oe,ak as Me,J as Ge,r as i,X as Ae,o as p,k as w,e as l,w as o,F as M,l as G,a as B,u as A,f as u,H as He,t as h,b as k,at as Ke,ao as ie,G as se,au as Pe,z as H,ap as de,aq as Qe,K as We,s as Ye,v as Ze,_ as el}from"./index-Dxllzmhq.js";import{r as ll}from"./index-DPt70WPP.js";const j=c=>(Ye("data-v-f819bc20"),c=c(),Ze(),c),tl={class:"userData leftTable"},al={style:{color:"#dd2c2c"}},ol={key:0},nl=j(()=>k("div",{class:"tableStyle"},"已选数据",-1)),il={class:"download"},sl={key:0,class:"option"},dl=j(()=>k("div",{style:{"padding-right":"10px"}},"下载内容",-1)),rl={key:1,class:"option"},ul=j(()=>k("div",{style:{"padding-right":"20px"}},"选择字段",-1)),cl={class:"option"},pl=j(()=>k("div",{style:{"padding-right":"10px"}},"导出格式",-1)),_l={class:"dialog-footer"},ml=Ie({name:"userData",__name:"index",setup(c){const d=s([]),n=s(1),V=s(10),x=s(0),D=s(!1),_=ne({title:"",category_id:void 0,template_id:void 0,visibility:void 0}),m=(a=1)=>y(this,null,function*(){D.value=!0,n.value=a;const t=yield Re(ae({page:n.value,page_size:V.value,review_state:z.value=="-1"?void 0:z.value},_));console.log(t),t.code===0&&(d.value=t.data.results,x.value=t.data.total),D.value=!1}),f=a=>{V.value=a,m()},S=a=>{n.value=a,m(n.value)},re=a=>{var t;return(t=oe.find(v=>v.value==a))==null?void 0:t.label},K=a=>{var t;return(t=je.find(v=>v.value==a))==null?void 0:t.label};Oe(()=>{m(),ke()});const z=s("-1"),ue=(a,t)=>{z.value=a.props.name,m()},P=s(),ce=()=>{m()},pe=a=>{a&&(a.resetFields(),m())},I=Me(),_e=()=>{I.push({name:"create"})},me=a=>{I.push({name:"create",query:{id:a.row.id}})},ve=a=>{I.push({name:"checkUserData",query:{id:a.row.id}})},fe=a=>y(this,null,function*(){Pe.confirm("确定要删除该数据吗？","删除数据",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>y(this,null,function*(){(yield Xe([a.row.id])).code===0&&(H({type:"success",message:"删除成功"}),m(d.value.length>1?n.value:n.value-1))}))}),U=s(!1),F=s(!1),g=s(),L=s(!0),$=s("JSON"),N=s([]),E=s(),ge=a=>y(this,null,function*(){U.value=!0,console.log("-----",a.row),g.value=a.row;const t=yield de(a.row.template_id);t.code===0&&(E.value=t.data),F.value=!1}),be=()=>y(this,null,function*(){L.value&&(N.value=[])}),ye=s(),C=s([]),we=a=>{console.log("val",a),C.value=a},J=s(!0),he=()=>y(this,null,function*(){if(C.value.length){if(U.value=!0,F.value=!0,J.value=C.value.every(a=>a.template_id===C.value[0].template_id),J.value){const a=yield de(C.value[0].template_id);a.code===0&&(E.value=a.data)}}else H({message:"请先选择数据！",type:"warning"})}),Q=()=>{$.value="JSON",g.value={},U.value=!1,L.value=!0,E.value=[],N.value=[],J.value=!0},W=s(),ke=()=>y(this,null,function*(){let a=yield ll();a.code===0&&(W.value=Ge(a.data))}),Ce=()=>y(this,null,function*(){let a=[];F.value?a=C.value.map(v=>v.id):a.push((g==null?void 0:g.value.id)+"");const t=yield Qe({async:!1,flat:!1,format:$.value,included_fields:N.value,meta_id_list:a,query_id:null,tid:null});t.code===0?(Q(),window.open("https://mgetest.micl.com.cn"+t.data.result)):H.error("下载失败")}),O=ne([]);function Ve(){return We({category:_.category_id,meta_only:!0,per_page:100}).then(a=>{O.splice(0,O.length,...a.data.templates)})}return(a,t)=>{const v=i("el-tab-pane"),xe=i("el-tabs"),De=i("el-input"),T=i("el-form-item"),Se=i("el-tree-select"),Y=i("el-option"),Z=i("el-select"),b=i("el-button"),ze=i("el-form"),r=i("el-table-column"),Ue=i("el-tooltip"),Le=i("el-pagination"),R=i("el-descriptions-item"),Ne=i("el-descriptions"),X=i("el-radio-button"),ee=i("el-radio-group"),Te=i("el-checkbox"),qe=i("el-checkbox-group"),Be=i("el-dialog"),Fe=Ae("loading");return p(),w("div",tl,[l(xe,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),class:"demo-tabs",onTabClick:ue},{default:o(()=>[l(v,{label:"全部",name:"-1"}),l(v,{label:"待审核",name:"0"}),l(v,{label:"已通过",name:"1"}),l(v,{label:"未通过",name:"2"})]),_:1},8,["modelValue"]),l(ze,{ref_key:"conditionFormRef",ref:P,size:"large",model:_,inline:!0,"label-width":"0"},{default:o(()=>[l(T,{label:"",prop:"title"},{default:o(()=>[l(De,{modelValue:_.title,"onUpdate:modelValue":t[1]||(t[1]=e=>_.title=e),placeholder:"输入数据名称/摘要等关键字",style:{width:"283px"},clearable:""},null,8,["modelValue"])]),_:1}),l(T,{label:"",prop:"category_id"},{default:o(()=>[l(Se,{filterable:"",modelValue:_.category_id,"onUpdate:modelValue":t[2]||(t[2]=e=>_.category_id=e),data:W.value,style:{width:"283px"},"check-on-click-node":"","check-strictly":"",onChange:Ve,placeholder:"请选择分类"},null,8,["modelValue","data"])]),_:1}),l(T,{label:"",prop:"template_id"},{default:o(()=>[l(Z,{filterable:"",modelValue:_.template_id,"onUpdate:modelValue":t[3]||(t[3]=e=>_.template_id=e),placeholder:"请选择模板",style:{width:"283px"},clearable:""},{default:o(()=>[(p(!0),w(M,null,G(O,e=>(p(),B(Y,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"",prop:"visibility"},{default:o(()=>[l(Z,{filterable:"",modelValue:_.visibility,"onUpdate:modelValue":t[4]||(t[4]=e=>_.visibility=e),placeholder:"请选择可见范围",style:{width:"283px"},clearable:""},{default:o(()=>[(p(!0),w(M,null,G(A(oe),e=>(p(),B(Y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(T,{label:""},{default:o(()=>[l(b,{type:"primary",onClick:ce},{default:o(()=>[u("查询")]),_:1}),l(b,{onClick:t[5]||(t[5]=e=>pe(P.value))},{default:o(()=>[u("重置")]),_:1}),l(b,{plain:"",type:"primary",onClick:_e},{default:o(()=>[u("新增")]),_:1}),l(b,{plain:"",type:"primary",onClick:he},{default:o(()=>[u(" 批量下载 ")]),_:1})]),_:1})]),_:1},8,["model"]),He((p(),B(A(ie),{size:"large",ref_key:"multipleTableRef",ref:ye,data:d.value,onSelectionChange:we},{default:o(()=>[l(r,{type:"selection",width:"40"}),l(r,{label:"序号",type:"index",index:1,width:"60",align:"center"}),l(r,{label:"数据名称",prop:"title","show-overflow-tooltip":"",width:"120",align:"center"}),l(r,{label:"摘要","show-overflow-tooltip":"",prop:"abstract","min-width":"300",align:"center"}),l(r,{"show-overflow-tooltip":"",label:"模板名称",prop:"template_title","min-width":"90",align:"center"}),l(r,{label:"可见范围",width:"150",align:"center"},{default:o(e=>[u(h(re(e.row.visibility)),1)]),_:1}),l(r,{label:"一级机构",prop:"project_name","show-overflow-tooltip":"",width:"100"}),l(r,{label:"二级机构",prop:"subject_name","show-overflow-tooltip":"",width:"100"}),l(r,{label:"审核状态",width:"100",align:"center"},{default:o(e=>[e.row.review_state==2?(p(),B(Ue,{key:0,placement:"top"},{content:o(()=>[u(h(e.row.disapprove_reason),1)]),default:o(()=>[k("span",al,h(K(e.row.review_state)),1)]),_:2},1024)):(p(),w("span",{key:1,style:Ke({color:e.row.review_state==1?"#888888":"#E5A303"})},h(K(e.row.review_state)),5))]),_:1}),l(r,{label:"上传时间",prop:"time",width:"170"}),l(r,{label:"操作",width:"200",fixed:"right",align:"center"},{default:o(e=>[l(b,{link:"",type:"primary",size:"small",onClick:q=>me(e)},{default:o(()=>[u(" 编辑 ")]),_:2},1032,["onClick"]),l(b,{link:"",type:"primary",size:"small",onClick:q=>ve(e)},{default:o(()=>[u(" 查看 ")]),_:2},1032,["onClick"]),l(b,{link:"",type:"danger",size:"small",onClick:q=>fe(e)},{default:o(()=>[u(" 删除 ")]),_:2},1032,["onClick"]),l(b,{link:"",type:"primary",size:"small",onClick:q=>ge(e)},{default:o(()=>[u(" 下载 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Fe,D.value]]),l(Le,{"current-page":n.value,"onUpdate:currentPage":t[6]||(t[6]=e=>n.value=e),"page-size":V.value,"onUpdate:pageSize":t[7]||(t[7]=e=>V.value=e),"page-sizes":[5,10,15,20],background:"",layout:"->,prev,pager,next,sizes,jumper,total",total:x.value,onSizeChange:f,onCurrentChange:S},null,8,["current-page","page-size","total"]),l(Be,{modal:"","close-on-click-modal":!1,modelValue:U.value,"onUpdate:modelValue":t[11]||(t[11]=e=>U.value=e),title:"下载选项",width:"500","align-center":"","destroy-on-close":"",onClose:Q},{footer:o(()=>[k("div",_l,[l(b,{type:"primary",onClick:Ce,size:"large",style:{width:"100%"}},{default:o(()=>[u(" 确定下载 ")]),_:1})])]),default:o(()=>[F.value?(p(),w("div",ol,[nl,l(A(ie),{size:"large",data:C.value},{default:o(()=>[l(r,{label:"数据标题",prop:"title",width:"88",align:"center"}),l(r,{label:"所属模板",prop:"template_title","min-width":"160",align:"center"}),l(r,{label:"上传者",prop:"real_name","min-width":"80",align:"center"}),l(r,{label:"发布时间",prop:"time","min-width":"140",align:"center"})]),_:1},8,["data"])])):(p(),B(Ne,{key:1,column:1},{default:o(()=>[l(R,{label:"标题:"},{default:o(()=>{var e;return[u(h((e=g.value)==null?void 0:e.title),1)]}),_:1}),l(R,{label:"作者:"},{default:o(()=>{var e;return[u(h((e=g.value)==null?void 0:e.real_name),1)]}),_:1}),l(R,{label:"提交时间:"},{default:o(()=>{var e;return[u(h((e=g.value)==null?void 0:e.time),1)]}),_:1}),l(R,{label:"模板名称:"},{default:o(()=>{var e;return[u(h((e=g.value)==null?void 0:e.template_title),1)]}),_:1})]),_:1})),k("div",il,[J.value?(p(),w("div",sl,[dl,l(ee,{size:"large",modelValue:L.value,"onUpdate:modelValue":t[8]||(t[8]=e=>L.value=e),onChange:be},{default:o(()=>[l(X,{value:!0,label:"全部字段下载"}),l(X,{value:!1,label:"部分字段下载"})]),_:1},8,["modelValue"])])):se("",!0),L.value?se("",!0):(p(),w("div",rl,[ul,l(qe,{modelValue:N.value,"onUpdate:modelValue":t[9]||(t[9]=e=>N.value=e)},{default:o(()=>[(p(!0),w(M,null,G(E.value,(e,q)=>(p(),w("div",{key:q,style:{"padding-left":"20px"}},[l(Te,{label:e.Name,value:e.Name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])])),k("div",cl,[pl,l(ee,{size:"large",modelValue:$.value,"onUpdate:modelValue":t[10]||(t[10]=e=>$.value=e)},{default:o(()=>[l(X,{label:"JSON",value:"JSON"}),l(X,{label:"XLSX",value:"XLSX"})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])])}}}),wl=el(ml,[["__scopeId","data-v-f819bc20"]]);export{wl as default};
