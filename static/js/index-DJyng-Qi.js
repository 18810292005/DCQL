var S=(c,b,l)=>new Promise((y,d)=>{var g=i=>{try{n(l.next(i))}catch(h){d(h)}},e=i=>{try{n(l.throw(i))}catch(h){d(h)}},n=i=>i.done?y(i.value):Promise.resolve(i.value).then(g,e);n((l=l.apply(c,b)).next())});import{ai as B,av as z,d as R,i as j,j as A,r as w,o as p,k as f,e as r,w as o,b as x,x as M,t as m,u as q,_ as I,c as P,h as G,C as J,a as V,f as v,G as D,F as W,l as H,R as K,M as N,W as Q}from"./index-Dxllzmhq.js";import{r as X}from"./setData-BXCfuNPN.js";const me=c=>B.get("/api/storage/mytemplates/"+z(c)),fe=c=>B.delete("/api/v1/storage/template/"+c),Y=c=>B.get("/api/storage/templates/"+c+"/"),Z={class:"tree"},ee=R({__name:"templateTree",props:{content:{type:Array,default:()=>[]}},setup(c){const b={children:"childern",label:d=>d.style?d.style.name||"无名字":d.label},l=c;let y=j([]);return A(()=>{y.value=l.content.map(d=>{if(d)return d.id})}),(d,g)=>{const e=w("el-tree");return p(),f("div",Z,[r(e,{style:{"max-width":"600px"},"default-expanded-keys":q(y),data:l.content,"node-key":"id",props:b},{default:o(({node:n,data:i})=>[x("div",null,[x("span",{class:M(["custom-tree-node",{node:i.childern.length>0}])},m(n.label),3)])]),_:1},8,["default-expanded-keys","data"])])}}}),te=I(ee,[["__scopeId","data-v-70340970"]]),ae={class:"userTemplate"},le={key:0,style:{color:"#e5a303"}},se={key:1,style:{color:"#358de3"}},oe={key:2,style:{color:"#dd2c2c"}},ne={class:"content"},ie={class:"outline"},re={class:"details"},ce={key:2,class:"dialog-footer"},de=R({__name:"index",props:{modelValue:{type:Boolean,default:!1},id:{type:String,default:""},isFragment:{type:Boolean,default:!1},isDownload:{type:Boolean,default:!1}},emits:["update:modelValue","updateList"],setup(c,{emit:b}){const l=c,y=b;function d(){l.isFragment?U(l.id+""):h(l.id)}const g=P({get(){return l.modelValue},set(){y("update:modelValue",!1)}}),e=j({title:""}),n=G([]);J("templateData",n);const i=_=>{var s;return(s=X.find(a=>a.value==_))==null?void 0:s.label},h=_=>S(this,null,function*(){if(_=="")return;const s=yield Y(_);if(s.code===0){let a=N(s.data.content,!1);n.splice(0,n.length,...a),e.value=s.data}}),U=_=>{_!=""&&Q(_).then(s=>{let a=N(s.data.content,!1);e.value.title=s.data.snippet_name,n.splice(0,n.length,...a)})},E=()=>{const _=JSON.stringify(e.value);var s=new Blob([_],{type:"text/plain;charset=utf-8"});const a=document.createElement("a"),k=URL.createObjectURL(s);a.href=k,a.download=`${e.value.title}.json`,a.click()};return(_,s)=>{var C;const a=w("el-descriptions-item"),k=w("el-descriptions"),O=w("el-button"),$=w("el-dialog");return p(),f("div",ae,[r($,{modal:"","close-on-click-modal":!1,modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=t=>g.value=t),title:(C=e.value)==null?void 0:C.title,width:"1200","align-center":"","destroy-on-close":"",onOpen:d},{default:o(()=>[l.isFragment?D("",!0):(p(),V(k,{key:0,title:"",column:2,class:"basic-descriptions"},{default:o(()=>[r(a,{label:"分类"},{default:o(()=>{var t;return[v(m((t=e.value)==null?void 0:t.category),1)]}),_:1}),r(a,{label:"可见范围"},{default:o(()=>{var t;return[v(m((t=e.value)!=null&&t.public?"公开":"私有"),1)]}),_:1}),r(a,{label:"摘要"},{default:o(()=>{var t;return[v(m((t=e.value)==null?void 0:t.abstract),1)]}),_:1}),r(a,{label:"审核状态"},{default:o(()=>{var t,u,L,T,F;return[((t=e.value)==null?void 0:t.review_state)==0?(p(),f("span",le,m(i((u=e.value)==null?void 0:u.review_state)),1)):((L=e.value)==null?void 0:L.review_state)==1?(p(),f("span",se,m(i((T=e.value)==null?void 0:T.review_state)),1)):(p(),f("span",oe,m(i((F=e.value)==null?void 0:F.review_state)),1))]}),_:1})]),_:1})),l.isFragment?D("",!0):(p(),V(k,{key:1,title:"审核信息",column:2},{default:o(()=>{var t;return[r(a,{label:"审核人"},{default:o(()=>{var u;return[v(m((u=e.value)==null?void 0:u.reviewer_real_name),1)]}),_:1}),r(a,{label:"审核单位"},{default:o(()=>{var u;return[v(m((u=e.value)==null?void 0:u.reviewer_institution),1)]}),_:1}),(t=e.value)!=null&&t.disapprove_reason?(p(),V(a,{key:0,label:"不通过原因"},{default:o(()=>{var u;return[v(m((u=e.value)==null?void 0:u.disapprove_reason),1)]}),_:1})):D("",!0)]}),_:1})),r(k,{title:"模板内容",column:1},{default:o(()=>[r(a,null,{default:o(()=>[x("div",ne,[x("div",ie,[r(te,{content:n},null,8,["content"])]),x("div",re,[(p(!0),f(W,null,H(n,t=>(p(),f("div",{key:t.id},[r(q(K),{blocks:t,disabled:!0,isExhibition:!0},null,8,["blocks"])]))),128))])])]),_:1})]),_:1}),c.isDownload?(p(),f("div",ce,[r(O,{size:"large",icon:"Download",type:"primary",plain:"",onClick:E},{default:o(()=>[v(" 下载 ")]),_:1})])):D("",!0)]),_:1},8,["modelValue","title"])])}}}),ve=I(de,[["__scopeId","data-v-f5eb5af4"]]);export{fe as a,me as r,ve as t};
