var D=(_,S,$)=>new Promise((b,h)=>{var T=f=>{try{V($.next(f))}catch(w){h(w)}},L=f=>{try{V($.throw(f))}catch(w){h(w)}},V=f=>f.done?b(f.value):Promise.resolve(f.value).then(T,L);V(($=$.apply(_,S)).next())});import{ai as Ne,d as qe,ak as Ie,i as a,j as Ue,a0 as He,r as c,X as Te,o as i,k as m,b as s,f as v,t as K,e,w as t,H as de,a as U,u as ie,ao as ue,F as ae,l as le,G as Y,ap as ce,z as te,aq as Be,s as Re,v as Xe,_ as Fe,B as Qe,h as We,m as Ye,I as ze,ar as De,as as Ze}from"./index-Dxllzmhq.js";const $e=(_,S)=>Ne.post(`/api/v2/search/query/?easy=${_.easy}&page=${_.page}&page_size=${_.page_size}`,S),ea=(_,S,$,b)=>Ne.get(`/api/v2/search/query/${_}/${S}?page=${$}&page_size=${b}`),re=_=>(Re("data-v-0bd0dbd0"),_=_(),Xe(),_),aa={class:"SearchContent-right"},la={class:"SearchContent-right-header"},ta={class:"header-left"},oa={style:{color:"#358de3"}},na={class:"header-right"},sa={class:"SearchContent-right-content"},da={key:0},ia=re(()=>s("div",{class:"tableStyle"},"已选数据",-1)),ua={class:"download"},ca={class:"option"},ra=re(()=>s("div",{style:{"padding-right":"10px"}},"下载内容",-1)),pa={key:0,class:"option"},va=re(()=>s("div",{style:{"padding-right":"20px"}},"选择字段",-1)),_a={class:"option"},ma=re(()=>s("div",{style:{"padding-right":"10px"}},"导出格式",-1)),ha={class:"dialog-footer"},ga=qe({name:"templateDetails",__name:"templateDetails",props:{templateID:Number,queryid:Number},emits:["goBack"],setup(_,{emit:S}){const $=Ie(),b=a(1),h=a(10),T=a(0),L=a(),V=a(!1),f=()=>D(this,null,function*(){V.value=!0;const u=yield ea(A.queryid+"",A.templateID+"",b.value,h.value);L.value=u.data.data,T.value=u.data.total,V.value=!1}),w=u=>{h.value=u,f()},E=u=>{b.value=u,f()};Ue(()=>{});const N=a(!1),B=a(!1),k=a({}),z=a(!0),y=a("JSON"),J=a([]),Q=a(),O=u=>D(this,null,function*(){N.value=!0,console.log("-----",u.row.data),k.value=u.row;const r=yield ce(A.templateID);r.code===0&&(Q.value=r.data),B.value=!1}),ve=()=>D(this,null,function*(){z.value&&(J.value=[])}),R=a(),W=a([]),G=u=>{console.log("val",u),W.value=u},_e=()=>D(this,null,function*(){if(W.value.length){N.value=!0,B.value=!0;const u=yield ce(A.templateID);u.code===0&&(Q.value=u.data)}else te({message:"请先选择数据！",type:"warning"})}),j=()=>{y.value="JSON",k.value={},N.value=!1,z.value=!0,Q.value=[],J.value=[]},me=()=>D(this,null,function*(){var C;let u=[];B.value?u=W.value.map(p=>p.data.id):u.push(((C=k==null?void 0:k.value.data)==null?void 0:C.id)+"");const r=yield Be({async:!1,flat:!1,format:y.value,included_fields:J.value,meta_id_list:u,query_id:null,tid:null});r.code===0?(j(),window.open("https://mgetest.micl.com.cn"+r.data.result)):te.error("下载失败")}),he=u=>{console.log("row.id",u.row,u.row.data.id),$.push({name:"checkUserData",query:{id:u.row.data.id,home:"home"}})},x=S,oe=()=>{x("goBack")},A=_;return He(()=>A.templateID,()=>{console.log(A),f()}),(u,r)=>{const C=c("el-button"),p=c("el-table-column"),M=c("el-pagination"),q=c("el-descriptions-item"),P=c("el-descriptions"),X=c("el-radio-button"),ne=c("el-radio-group"),ge=c("el-checkbox"),fe=c("el-checkbox-group"),I=c("el-dialog"),ye=Te("loading");return i(),m("div",aa,[s("div",la,[s("div",ta,[v(" 搜索结果，共 "),s("span",oa,K(T.value),1),v(" 条 ")]),s("div",na,[e(C,{icon:"",onClick:oe},{default:t(()=>[v("返回")]),_:1}),e(C,{plain:"",type:"primary",onClick:_e},{default:t(()=>[v(" 批量下载 ")]),_:1})])]),s("div",sa,[de((i(),U(ie(ue),{size:"large",ref_key:"multipleTableRef",ref:R,data:L.value,style:{width:"100%"},onSelectionChange:G},{default:t(()=>[e(p,{type:"selection",width:"40"}),e(p,{label:"序号",type:"index",index:1,width:"60",align:"center"}),e(p,{label:"名称",prop:"data.title",width:"120",align:"center"}),e(p,{label:"上传人",prop:"data.real_name",width:"120",align:"center"}),e(p,{label:"摘要",prop:"data.abstract","min-width":"150",align:"center"}),e(p,{label:"所属分类",prop:"data.category",width:"100","show-overflow-tooltip":"",align:"center"}),e(p,{label:"一级机构",prop:"data.project",width:"150",align:"center","show-overflow-tooltip":""}),e(p,{label:"二级机构",prop:"data.subject",width:"150",align:"center","show-overflow-tooltip":""}),e(p,{label:"发布时间",prop:"data.add_time",width:"110",align:"center"}),e(p,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(n=>[e(C,{link:"",type:"primary",size:"small",onClick:g=>he(n)},{default:t(()=>[v(" 查看 ")]),_:2},1032,["onClick"]),e(C,{link:"",type:"primary",size:"small",onClick:g=>O(n)},{default:t(()=>[v(" 下载 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,V.value]]),e(M,{"current-page":b.value,"onUpdate:currentPage":r[0]||(r[0]=n=>b.value=n),"page-size":h.value,"onUpdate:pageSize":r[1]||(r[1]=n=>h.value=n),"page-sizes":[5,10,15,20],background:"",layout:"->,prev,pager,next,sizes,jumper,total",total:T.value,onSizeChange:w,onCurrentChange:E},null,8,["current-page","page-size","total"]),e(I,{modal:"","close-on-click-modal":!1,modelValue:N.value,"onUpdate:modelValue":r[5]||(r[5]=n=>N.value=n),title:"下载选项",width:"500","align-center":"","destroy-on-close":"",onClose:j},{footer:t(()=>[s("div",ha,[e(C,{type:"primary",onClick:me,size:"large",style:{width:"100%"}},{default:t(()=>[v(" 确定下载 ")]),_:1})])]),default:t(()=>[B.value?(i(),m("div",da,[ia,e(ie(ue),{size:"large",data:W.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"数据标题",prop:"data.title",width:"100",align:"center"}),e(p,{label:"所属模板",prop:"data.template","min-width":"120",align:"center"}),e(p,{label:"上传者",prop:"data.real_name","min-width":"100",align:"center"}),e(p,{label:"发布时间",prop:"data.add_time","min-width":"120",align:"center"})]),_:1},8,["data"])])):(i(),U(P,{key:1,column:1},{default:t(()=>[e(q,{label:"标题:"},{default:t(()=>{var n,g;return[v(K((g=(n=k.value)==null?void 0:n.data)==null?void 0:g.title),1)]}),_:1}),e(q,{label:"作者:"},{default:t(()=>{var n,g;return[v(K((g=(n=k.value)==null?void 0:n.data)==null?void 0:g.real_name),1)]}),_:1}),e(q,{label:"提交时间:"},{default:t(()=>{var n,g;return[v(K((g=(n=k.value)==null?void 0:n.data)==null?void 0:g.add_time),1)]}),_:1}),e(q,{label:"模板名称:"},{default:t(()=>{var n,g;return[v(K((g=(n=k.value)==null?void 0:n.data)==null?void 0:g.template),1)]}),_:1})]),_:1})),s("div",ua,[s("div",ca,[ra,e(ne,{size:"large",modelValue:z.value,"onUpdate:modelValue":r[2]||(r[2]=n=>z.value=n),onChange:ve},{default:t(()=>[e(X,{value:!0,label:"全部字段下载"}),e(X,{value:!1,label:"部分字段下载"})]),_:1},8,["modelValue"])]),z.value?Y("",!0):(i(),m("div",pa,[va,e(fe,{modelValue:J.value,"onUpdate:modelValue":r[3]||(r[3]=n=>J.value=n)},{default:t(()=>[(i(!0),m(ae,null,le(Q.value,(n,g)=>(i(),m("div",{key:g,style:{"padding-left":"20px"}},[e(ge,{label:n.Name,value:n.Name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])])),s("div",_a,[ma,e(ne,{size:"large",modelValue:y.value,"onUpdate:modelValue":r[4]||(r[4]=n=>y.value=n)},{default:t(()=>[e(X,{label:"JSON",value:"JSON"}),e(X,{label:"XLSX",value:"XLSX"})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])])])}}}),fa=Fe(ga,[["__scopeId","data-v-0bd0dbd0"]]),pe=_=>(Re("data-v-7dab78fb"),_=_(),Xe(),_),ya={class:"SearchContent"},ba={class:"SearchContent-header"},wa={class:"home-search"},ka={class:"SearchContent-content"},Ca={class:"SearchContent-content-subset topCenter"},Sa={class:"SearchContent-left"},Va={key:1,class:"no-data"},xa={key:1,class:"no-data"},za={class:"SearchContent-right"},Da={class:"SearchContent-right-header"},$a={class:"header-left"},Na={style:{color:"#358de3"}},qa={class:"header-right"},Ia={class:"SearchContent-right-content"},Ua={key:0},Ta=pe(()=>s("div",{class:"tableStyle"},"已选数据",-1)),Ba={class:"download"},Ra={key:0,class:"option"},Xa=pe(()=>s("div",{style:{"padding-right":"10px"}},"下载内容",-1)),Fa={key:1,class:"option"},Ja=pe(()=>s("div",{style:{"padding-right":"20px"}},"选择字段",-1)),Oa={class:"option"},ja=pe(()=>s("div",{style:{"padding-right":"10px"}},"导出格式",-1)),Aa={class:"dialog-footer"},Pa=qe({name:"SearchContent",__name:"index",setup(_){let S=Qe();Ie();const $=We([{value:"0",label:"全文检索"},{value:"1",label:"数据名称"},{value:"2",label:"摘要"},{value:"3",label:"上传人"},{value:"4",label:"关键词"}]),b=a("0"),h=a(""),T=a(),L=a(),V=a(),f=a(),w=a(),E=a(1),N=a(10),B=a(0);Ue(()=>{S.query.type&&S.query.search&&(b.value=S.query.type,h.value=S.query.search,k())});const k=()=>{if(h.value){switch(y.value={text:"",title:[],abstract:[],real_name:[],keywords:[],category:[]},O.value=[],R.value=[],x.value=!0,b.value){case"0":y.value.text=h.value;break;case"1":y.value.title.push(h.value);break;case"2":y.value.abstract.push(h.value);break;case"3":O.value.push(h.value),y.value.real_name=O.value;break;case"4":R.value.push(h.value),y.value.keywords=R.value;break}_e()}},z=a({easy:1,page:E.value,page_size:N.value}),y=a({text:"",title:[],abstract:[],real_name:[],keywords:[],category:[]}),J=a(),Q=()=>{y.value.category=J.value.getCheckedKeys(),j()},O=a([]),ve=()=>{y.value.real_name=O.value,j()},R=a([]),W=()=>{console.log(R.value),y.value.keywords=R.value,j()},G=a(!1),_e=()=>D(this,null,function*(){G.value=!0;const o=yield $e(z.value,y.value);o.code===0&&(T.value=o.data.templates_result,L.value=o.data.category_result,V.value=o.data.keywords_result,f.value=o.data.real_name_result,w.value=o.data.id,B.value=o.data.total_templates),G.value=!1}),j=()=>D(this,null,function*(){G.value=!0;const o=yield $e(z.value,y.value);o.code===0&&(T.value=o.data.templates_result,w.value=o.data.id,B.value=o.data.total_templates),G.value=!1}),me=o=>{N.value=o,console.log("object",z.value),z.value.page_size=o,j()},he=o=>{E.value=o,console.log(E),z.value.page=o,j()},x=a(!0),oe=a(),A=o=>{x.value=!x.value,oe.value=o.row.template_id},u=()=>{x.value=!x.value},r=a(!1),C=a(!1),p=a({}),M=a(!0),q=a("JSON"),P=a([]),X=a(),ne=o=>{r.value=!0,p.value=o.row,ce(p.value.template_id).then(d=>{d.code===0?X.value=d.data:C.value=!1}).catch(()=>{console.log("错误"),r.value=!1})},ge=()=>D(this,null,function*(){M.value&&(P.value=[])}),fe=a(),I=a([]),ye=o=>{I.value=o},n=a(!0),g=()=>D(this,null,function*(){if(I.value.length){if(r.value=!0,C.value=!0,n.value=I.value.every(o=>o.template_id===I.value[0].template_id),n.value){const o=yield ce(I.value[0].template_id);o.code===0&&(X.value=o.data)}}else te({message:"请先选择数据！",type:"warning"})}),be=()=>{q.value="JSON",p.value={},r.value=!1,M.value=!0,X.value=[],P.value=[],n.value=!0},Je=()=>D(this,null,function*(){if(C.value){const o=a([]);I.value.forEach(Z=>{o.value.push({async:!1,flat:!1,format:q.value,included_fields:P.value,meta_id_list:[],query_id:w.value,tid:Z.template_id+""})}),yield De(w.value,{download:{template:{include:I.value.map(Z=>Z.template_id)}}});const d=yield Ze({batches:o.value});d.code===0?(be(),window.open("https://mgetest.micl.com.cn"+d.data.result[0])):te.error("下载失败")}else{yield De(w.value,{download:{template:{include:[p.value.template_id]}}});const o=yield Be({async:!1,flat:!1,format:q.value,included_fields:P.value,meta_id_list:[],query_id:w.value,tid:p.value.template_id+""});o.code===0?(be(),window.open("https://mgetest.micl.com.cn"+o.data.result)):te.error("下载失败")}}),Oe={children:"children",label:"name",disabled:()=>!x.value},Se=a(["1","2","3"]);return(o,d)=>{const Z=c("el-option"),je=c("el-select"),ee=c("el-button"),Ae=c("el-input"),Pe=c("el-tree"),we=c("el-collapse-item"),ke=c("el-checkbox"),Ce=c("el-checkbox-group"),Ke=c("el-collapse"),F=c("el-table-column"),Le=c("el-pagination"),Ve=c("el-descriptions-item"),Ee=c("el-descriptions"),se=c("el-radio-button"),xe=c("el-radio-group"),Ge=c("el-dialog"),Me=Te("loading");return i(),m("div",ya,[s("div",ba,[s("div",wa,[e(Ae,{modelValue:h.value,"onUpdate:modelValue":d[1]||(d[1]=l=>h.value=l),placeholder:"输入检索内容",style:{height:"70px"},onKeyup:Ye(k,["enter"])},{prepend:t(()=>[e(je,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=l=>b.value=l),style:{width:"100px",height:"70px"}},{default:t(()=>[(i(!0),m(ae,null,le($,l=>(i(),U(Z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),append:t(()=>[e(ee,{class:"search-btn",type:"success",onClick:k},{default:t(()=>[v(" 搜索 ")]),_:1})]),_:1},8,["modelValue"])])]),s("div",ka,[s("div",Ca,[s("div",Sa,[e(Ke,{modelValue:Se.value,"onUpdate:modelValue":d[4]||(d[4]=l=>Se.value=l)},{default:t(()=>[e(we,{title:"材料分类",name:"1"},{default:t(()=>[e(Pe,{ref_key:"tree",ref:J,style:{"max-width":"600px",padding:"20px"},data:L.value,props:Oe,"node-key":"id",onCheckChange:Q,"show-checkbox":""},null,8,["data"])]),_:1}),e(we,{title:"创建人",name:"2"},{default:t(()=>[f.value&&f.value.length>0?(i(),U(Ce,{key:0,modelValue:O.value,"onUpdate:modelValue":d[2]||(d[2]=l=>O.value=l),onChange:ve,disabled:!x.value},{default:t(()=>[(i(!0),m(ae,null,le(f.value,(l,H)=>(i(),m("div",{key:H},[e(ke,{label:l.real_name,value:l.real_name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue","disabled"])):(i(),m("div",Va,"暂无数据"))]),_:1}),e(we,{title:"关键词",name:"3"},{default:t(()=>[V.value&&V.value.length>0?(i(),U(Ce,{key:0,modelValue:R.value,"onUpdate:modelValue":d[3]||(d[3]=l=>R.value=l),onChange:W,disabled:!x.value},{default:t(()=>[(i(!0),m(ae,null,le(V.value,(l,H)=>(i(),m("div",{key:H},[e(ke,{label:l.keywords,value:l.keywords},null,8,["label","value"])]))),128))]),_:1},8,["modelValue","disabled"])):(i(),m("div",xa,"暂无数据"))]),_:1})]),_:1},8,["modelValue"])]),de(s("div",za,[s("div",Da,[s("div",$a,[v(" 搜索结果，共 "),s("span",Na,K(B.value),1),v(" 条 ")]),s("div",qa,[o.$checkPermission([2,3,4])?(i(),U(ee,{key:0,plain:"",type:"primary",onClick:g},{default:t(()=>[v(" 批量下载 ")]),_:1})):Y("",!0)])]),s("div",Ia,[de((i(),U(ie(ue),{size:"large",ref_key:"multipleTableRef",ref:fe,data:T.value,style:{width:"100%"},onSelectionChange:ye},{default:t(()=>[e(F,{type:"selection",width:"40"}),e(F,{label:"序号",type:"index",index:1,width:"60",align:"center"}),e(F,{label:"材料分类",prop:"category_name",width:"200",align:"center"}),e(F,{label:"模板名称",prop:"template_name","min-width":"300",align:"center"}),e(F,{label:"数据条数",prop:"count_at_least","min-width":"200",align:"center"}),e(F,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(l=>[o.$checkPermission([2,3,4])?(i(),U(ee,{key:0,link:"",type:"primary",size:"small",onClick:H=>A(l)},{default:t(()=>[v(" 查看 ")]),_:2},1032,["onClick"])):Y("",!0),o.$checkPermission([2,3,4])?(i(),U(ee,{key:1,link:"",type:"primary",size:"small",onClick:H=>ne(l)},{default:t(()=>[v(" 下载 ")]),_:2},1032,["onClick"])):Y("",!0)]),_:1})]),_:1},8,["data"])),[[Me,G.value]]),e(Le,{"current-page":E.value,"onUpdate:currentPage":d[5]||(d[5]=l=>E.value=l),"page-size":N.value,"onUpdate:pageSize":d[6]||(d[6]=l=>N.value=l),"page-sizes":[5,10,15,20],background:"",layout:"->,prev,pager,next,sizes,jumper,total",total:B.value,onSizeChange:me,onCurrentChange:he},null,8,["current-page","page-size","total"]),e(Ge,{modal:"","close-on-click-modal":!1,modelValue:r.value,"onUpdate:modelValue":d[10]||(d[10]=l=>r.value=l),title:"下载选项",width:"500","align-center":"","destroy-on-close":"",onClose:be},{footer:t(()=>[s("div",Aa,[e(ee,{type:"primary",onClick:Je,size:"large",style:{width:"100%"}},{default:t(()=>[v(" 确定下载 ")]),_:1})])]),default:t(()=>[C.value?(i(),m("div",Ua,[Ta,e(ie(ue),{size:"large",data:I.value},{default:t(()=>[e(F,{label:"数据标题",prop:"category_name",width:"100",align:"center"}),e(F,{label:"模板名称",prop:"template_name","min-width":"100",align:"center"}),e(F,{label:"数据条数",prop:"count_at_least","min-width":"50",align:"center"})]),_:1},8,["data"])])):(i(),U(Ee,{key:1,column:1},{default:t(()=>[e(Ve,{label:"模板名称:"},{default:t(()=>{var l;return[v(K((l=p.value)==null?void 0:l.template_name),1)]}),_:1}),e(Ve,{label:"数据条数:"},{default:t(()=>{var l;return[v(K((l=p.value)==null?void 0:l.count_at_least),1)]}),_:1})]),_:1})),s("div",Ba,[n.value?(i(),m("div",Ra,[Xa,e(xe,{size:"large",modelValue:M.value,"onUpdate:modelValue":d[7]||(d[7]=l=>M.value=l),onChange:ge},{default:t(()=>[e(se,{value:!0,label:"全部字段下载"}),e(se,{value:!1,label:"部分字段下载"})]),_:1},8,["modelValue"])])):Y("",!0),M.value?Y("",!0):(i(),m("div",Fa,[Ja,e(Ce,{modelValue:P.value,"onUpdate:modelValue":d[8]||(d[8]=l=>P.value=l)},{default:t(()=>[(i(!0),m(ae,null,le(X.value,(l,H)=>(i(),m("div",{key:H,style:{"padding-left":"20px"}},[e(ke,{label:l.Name,value:l.Name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])])),s("div",Oa,[ja,e(xe,{size:"large",modelValue:q.value,"onUpdate:modelValue":d[9]||(d[9]=l=>q.value=l)},{default:t(()=>[e(se,{label:"JSON",value:"JSON"}),e(se,{label:"XLSX",value:"XLSX"})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])])],512),[[ze,x.value]]),de(e(fa,{onGoBack:u,templateID:oe.value,queryid:w.value},null,8,["templateID","queryid"]),[[ze,!x.value]])])])])}}}),Ea=Fe(Pa,[["__scopeId","data-v-7dab78fb"]]);export{Ea as default};
