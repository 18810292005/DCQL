var V=(p,i,n)=>new Promise((m,b)=>{var e=d=>{try{_(n.next(d))}catch(g){b(g)}},k=d=>{try{_(n.throw(d))}catch(g){b(g)}},_=d=>d.done?m(d.value):Promise.resolve(d.value).then(e,k);_((n=n.apply(p,i)).next())});import{S as $}from"./index-D0yvvg8b.js";import{s as j}from"./selectTempalte-ekjaXs3x.js";import{d as E,i as y,B as G,h as C,j as O,r as c,o as h,k as W,b as a,t as z,e as l,w as o,f as u,a as M,G as S,F as A,J as H,U as K,V as P,W as Q,g as D,z as X,s as Y,v as Z,_ as ee}from"./index-Dxllzmhq.js";import{r as te}from"./index-DPt70WPP.js";const I=p=>(Y("data-v-bcabd7f3"),p=p(),Z(),p),ae={class:"templateManage"},le={class:"templateManage_header"},se={class:"templateManage_header_title"},oe={class:"templateManage_header_title_left"},ie={class:"templateManage_center"},de={class:"tips"},re={class:"form"},ne=I(()=>a("div",{class:"selectTips"}," 公共模板在审核通过之后，模板将进入模板库，同时也可供他人使用，且不允许再次修改；私有模板审核通过之后可修改，但只能新增字段，不能删除原有字段 ",-1)),ue=I(()=>a("div",{class:"contont"},[a("p",null,"模板修改说明"),u(" 模板修改提交/暂存后，需要重新审核才可继续创建数据，如果模板下已经存在数据，则修改模板需要遵循以下规则： "),a("br"),u(" 1.不能修改旧字段的名称和类型； "),a("br"),u(" 2.不能删除旧字段； "),a("br"),u(" 3.可以添加新的字段； "),a("br"),u(" 4.可以修改字段的顺序。 ")],-1)),ce=E({__name:"update",setup(p){const i=y("is_data"),{query:n}=G(),m=y(!1),b=y(),e=C({is_tem:"",title:"",category:"",abstract:"",public:"",published:!1}),k=C({title:[{required:!0,message:"请输入模板名称",trigger:"change"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],public:[{required:!0,message:"请选择可见范围",trigger:"change"}]}),_=y(null),d=()=>V(this,null,function*(){let s=yield te();return s.code===0&&(b.value=H(s.data,!1)),s}),g=()=>{K(e.title).catch(()=>{e.title=""})};function N(s){return P(s).then(t=>{e.title=t.data.title,e.abstract=t.data.abstract,e.category=t.data.category_id+"",e.public=t.data.public})}function U(s){Q(s).then(t=>{e.title=t.data.snippet_name,e.abstract=t.data.abstract})}let T="";const q=s=>V(this,null,function*(){s&&(yield s.validate((t,f)=>{t&&(console.log(e),D.push({name:"editor",query:{templateId:T,id:n.id,editorType:i.value,basicData:encodeURIComponent(JSON.stringify(e))}}))}))});function B(s){T=s,m.value=!1,X.success("选择模板成功")}function F(){D.go(-1)}return O(()=>{n.id?(i.value=n.type,i.value==="is_data"?d().then(()=>{N(n.id)}):d().then(()=>{U(n.id)})):d()}),(s,t)=>{const f=c("el-button"),v=c("el-form-item"),x=c("el-input"),R=c("el-tree-select"),w=c("el-option"),L=c("el-select"),J=c("el-form");return h(),W(A,null,[a("div",ae,[a("div",le,[a("div",se,[a("div",oe,z(e.title),1),a("div",null,[l($,{index:1})]),a("div",null,[l(f,{class:"btn",size:"large",onClick:t[0]||(t[0]=r=>q(_.value))},{default:o(()=>[u(" 下一步 ")]),_:1}),l(f,{class:"btn",size:"large",onClick:F},{default:o(()=>[u("取消")]),_:1})])])]),a("div",ie,[a("div",de,[a("p",null,z(i.value=="is_data"?"修改模板":"修改模板片段"),1)]),a("div",re,[l(J,{rules:k,ref_key:"ruleFormRef",ref:_,model:e,size:"large","status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:o(()=>[l(v,{prop:"password",label:"选择创建模板类型"},{default:o(()=>[l(f,{type:i.value=="is_data"?"primary":"",class:"btn",size:"large"},{default:o(()=>[u(" 数据模板 ")]),_:1},8,["type"]),l(f,{type:i.value!=="is_data"?"primary":"",class:"btn",size:"large"},{default:o(()=>[u(" 模板片段 ")]),_:1},8,["type"])]),_:1}),l(v,{prop:"title",label:"模板名称"},{default:o(()=>[l(x,{modelValue:e.title,"onUpdate:modelValue":t[2]||(t[2]=r=>e.title=r),modelModifiers:{trim:!0},disabled:"",onBlur:g,placeholder:"请输入模板名称"},{append:o(()=>[l(f,{onClick:t[1]||(t[1]=r=>m.value=!0),disabled:""},{default:o(()=>[u("模板库（导入已有模板）")]),_:1})]),_:1},8,["modelValue"])]),_:1}),i.value=="is_data"?(h(),M(v,{key:0,prop:"category",label:"选择分类"},{default:o(()=>[l(R,{filterable:"",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=r=>e.category=r),modelModifiers:{trim:!0},data:b.value,disabled:"","default-expanded-keys":[e.category],"default-checked-keys":[e.category],"node-key":"value",size:"large","check-on-click-node":"","check-strictly":""},null,8,["modelValue","data","default-expanded-keys","default-checked-keys"])]),_:1})):S("",!0),i.value=="is_data"?(h(),M(v,{key:1,label:"摘要",prop:"abstract"},{default:o(()=>[l(x,{modelValue:e.abstract,"onUpdate:modelValue":t[4]||(t[4]=r=>e.abstract=r),modelModifiers:{trim:!0},rows:4,type:"textarea",disabled:"",placeholder:"请输入摘要"},null,8,["modelValue"])]),_:1})):S("",!0),i.value=="is_data"?(h(),M(v,{key:2,label:"可见范围",prop:"public"},{default:o(()=>[l(L,{filterable:"",modelValue:e.public,"onUpdate:modelValue":t[5]||(t[5]=r=>e.public=r),modelModifiers:{trim:!0},disabled:"",placeholder:"请选择可见范围"},{default:o(()=>[l(w,{label:"公开",value:!0}),l(w,{label:"私有",value:!1})]),_:1},8,["modelValue"]),ne]),_:1})):S("",!0)]),_:1},8,["rules","model"]),ue])])]),l(j,{modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=r=>m.value=r),onSelectTemplate:B},null,8,["modelValue"])],64)}}}),ge=ee(ce,[["__scopeId","data-v-bcabd7f3"]]);export{ge as default};
