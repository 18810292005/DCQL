var M=(f,n,o)=>new Promise((T,u)=>{var h=r=>{try{y(o.next(r))}catch(p){u(p)}},t=r=>{try{y(o.throw(r))}catch(p){u(p)}},y=r=>r.done?T(r.value):Promise.resolve(r.value).then(h,t);y((o=o.apply(f,n)).next())});import{S as L}from"./index-D0yvvg8b.js";import{s as O}from"./selectTempalte-ekjaXs3x.js";import{d as $,i as k,B as j,h as D,j as E,r as m,o as _,k as G,b as d,e as s,w as i,f as g,u as S,a as b,S as W,G as x,T as A,F as H,J as K,U as P,V as Q,W as X,g as Y,z as Z,s as ee,v as te,_ as ae}from"./index-Dxllzmhq.js";import{r as le}from"./index-DPt70WPP.js";const I=f=>(ee("data-v-279d946c"),f=f(),te(),f),se={class:"templateManage"},oe={class:"templateManage_header"},ie={class:"templateManage_header_title topCenter"},de=I(()=>d("div",{class:"templateManage_header_title_left"},"创建模板",-1)),ne={class:"templateManage_center topCenter"},re=I(()=>d("div",{class:"tips"},[d("p",null,"请选择要进行的操作"),d("p",null,[g(" 1.上传模板片段:为方便用户创建模板，用户可自行创建模板片段，在创建数据所需模板时可嵌套使用用户自己创建的模板片段模板片段归用户所属。 "),d("br"),g(" 2.上传数据模板:为数据上传一个合适格式的模板。(同原·创建模板”) ")])],-1)),ue={class:"form"},pe=I(()=>d("div",{class:"selectTips"}," 公共模板在审核通过之后，模板将进入模板库，同时也可供他人使用，且不允许再次修改；私有模板审核通过之后可修改，但只能新增字段，不能删除原有字段 ",-1)),ce=$({__name:"index",setup(f){const n=k("is_data"),{query:o}=j();function T(l){n.value=l}const u=k(!1),h=k(),t=D({is_tem:"",title:"",category:"",abstract:"",public:"",published:!1}),y=D({title:[{required:!0,message:"请输入模板名称",trigger:"change"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],public:[{required:!0,message:"请选择可见范围",trigger:"change"}]}),r=k(null),p=()=>M(this,null,function*(){let l=yield le();return l.code===0&&(h.value=K(l.data,!1)),l}),N=()=>{P(t.title).catch(()=>{t.title=""})};function R(l){return Q(l).then(e=>{t.title=e.data.title,t.abstract=e.data.abstract,t.category=e.data.category_id+"",t.public=e.data.public||"1"})}function q(l){X(l).then(e=>{t.title=e.data.snippet_name,t.abstract=e.data.abstract})}let c=k("");const z=l=>M(this,null,function*(){l&&(yield l.validate((e,V)=>{e&&(console.log(t),Y.push({name:"editor",query:{templateId:c.value,id:o.id,editorType:n.value,basicData:encodeURIComponent(JSON.stringify(t))}}))}))});function U(l){c.value=l,u.value=!1,Z.success("选择模板成功")}return E(()=>{n.value=o.type||"is_data",o.basicData&&Object.assign(t,JSON.parse(decodeURIComponent(o.basicData))),o.id?n.value==="is_data"?p().then(()=>{R(o.id)}):p().then(()=>{q(o.id)}):p()}),(l,e)=>{const V=m("el-button"),v=m("el-form-item"),C=m("el-input"),B=m("el-tree-select"),w=m("el-option"),F=m("el-select"),J=m("el-form");return _(),G(H,null,[d("div",se,[d("div",oe,[d("div",ie,[de,d("div",null,[s(L,{index:1})]),d("div",null,[s(V,{class:"btn",size:"large",onClick:e[0]||(e[0]=a=>z(r.value))},{default:i(()=>[g(" 下一步 ")]),_:1})])])]),d("div",ne,[re,d("div",ue,[s(J,{rules:y,ref_key:"ruleFormRef",ref:r,model:t,size:"large","status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:i(()=>[s(v,{prop:"password",label:"选择创建模板类型"},{default:i(()=>[s(V,{type:n.value=="is_data"?"primary":"",onClick:e[1]||(e[1]=a=>T("is_data")),class:"btn",disabled:S(o).id,size:"large"},{default:i(()=>[g(" 数据模板 ")]),_:1},8,["type","disabled"]),s(V,{type:n.value!=="is_data"?"primary":"",onClick:e[2]||(e[2]=a=>T("is_fragment")),class:"btn",disabled:S(o).id,size:"large"},{default:i(()=>[g(" 模板片段 ")]),_:1},8,["type","disabled"])]),_:1}),s(v,{prop:"title",label:"模板名称"},{default:i(()=>[s(C,{modelValue:t.title,"onUpdate:modelValue":e[4]||(e[4]=a=>t.title=a),modelModifiers:{trim:!0},onBlur:N,placeholder:"请输入模板名称"},{append:i(()=>[s(V,{class:"btn",onClick:e[3]||(e[3]=a=>u.value=!0)},{default:i(()=>[g("模板库（导入已有模板）")]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(c)!==""?(_(),b(v,{key:0,label:"模板ID"},{default:i(()=>[s(C,{modelValue:S(c),"onUpdate:modelValue":e[5]||(e[5]=a=>W(c)?c.value=a:c=a),modelModifiers:{trim:!0},disabled:!0,placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1})):x("",!0),n.value=="is_data"?(_(),b(v,{key:1,prop:"category",label:"选择分类"},{default:i(()=>[s(B,{filterable:"",modelValue:t.category,"onUpdate:modelValue":e[6]||(e[6]=a=>t.category=a),modelModifiers:{trim:!0},data:h.value,"default-expanded-keys":[t.category],"default-checked-keys":[t.category],"node-key":"value",size:"large","check-on-click-node":"","check-strictly":""},null,8,["modelValue","data","default-expanded-keys","default-checked-keys"])]),_:1})):x("",!0),n.value=="is_data"?(_(),b(v,{key:2,label:"摘要",prop:"abstract"},{default:i(()=>[s(C,{modelValue:t.abstract,"onUpdate:modelValue":e[7]||(e[7]=a=>t.abstract=a),modelModifiers:{trim:!0},rows:4,type:"textarea",placeholder:"请输入摘要"},null,8,["modelValue"])]),_:1})):x("",!0),n.value=="is_data"?(_(),b(v,{key:3,label:"可见范围",prop:"public"},{default:i(()=>[s(F,{filterable:"",modelValue:t.public,"onUpdate:modelValue":e[8]||(e[8]=a=>t.public=a),modelModifiers:{trim:!0},placeholder:"请选择可见范围"},{default:i(()=>[s(w,{label:"公开",value:!0}),s(w,{label:"私有",value:!1})]),_:1},8,["modelValue"]),pe]),_:1})):x("",!0)]),_:1},8,["rules","model"])])])]),n.value=="is_data"?(_(),b(O,{key:0,modelValue:u.value,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value=a),onSelectTemplate:U},null,8,["modelValue"])):(_(),b(A,{key:1,modelValue:u.value,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value=a),onSelectTemplate:U},null,8,["modelValue"]))],64)}}}),ge=ae(ce,[["__scopeId","data-v-279d946c"]]);export{ge as default};
