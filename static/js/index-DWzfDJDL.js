var S=(s,d,p)=>new Promise((_,g)=>{var n=i=>{try{m(p.next(i))}catch(C){g(C)}},k=i=>{try{m(p.throw(i))}catch(C){g(C)}},m=i=>i.done?_(i.value):Promise.resolve(i.value).then(n,k);m((p=p.apply(s,d)).next())});import{ai as O,d as ne,i as h,h as D,j as oe,r as c,X as se,o as V,k as q,e as t,w as o,f as u,H as ie,a as E,t as z,b as M,at as re,u as R,ao as ce,au as N,z as B,g as ue,_ as de}from"./index-Dxllzmhq.js";import{r as pe,v as _e}from"./setData-BXCfuNPN.js";const ge=s=>O.get(`/api/storage/review/datalist/?page=${s.page}&page_size=${s.page_size}&${s.review_state!="-1"?"review_state="+s.review_state:""}`),T=s=>O.patch("/api/storage/review/datalist/batch/",s);function me(s,d){var p={M:s.getMonth()+1,d:s.getDate(),h:s.getHours(),m:s.getMinutes(),s:s.getSeconds(),q:Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};return d=d.replace(/([yMdhmsqS])+/g,function(_,g){var n=p[g];return n!==void 0?(_.length>1&&(n="0"+n,n=n.substr(n.length-_.length)),n):g==="y"?(s.getFullYear()+"").substr(4-_.length):_}),d}const fe={class:"dataReview leftTable"},ve={style:{color:"#dd2c2c"}},be={class:"dialog-footer"},he=ne({__name:"index",setup(s){const d=h("-1"),p=(e,a)=>{Object.assign(n,{review_state:e.props.name}),n.page=1,i()},_=h(),g=h(0),n=D({page:1,page_size:10,review_state:"-1"}),k=h(!1),m=D([]);function i(){k.value=!0,ge(n).then(e=>{m.splice(0,m.length),Object.assign(m,e.data.results),g.value=e.data.count}).finally(()=>{k.value=!1})}const C=e=>{n.page_size=e,i()};function x(e){n.page=e,i()}const j=e=>{var a;return(a=pe.find(f=>f.value==e))==null?void 0:a.label},v=D([]);function A(e){v.splice(0,v.length),Object.assign(v,e)}const F=(e,a)=>e.review_state==0;function H(){let e=v.map(a=>a.id);N.confirm("确认数据内容已经无误，是否确认通过？","审核通过",{confirmButtonText:"确认通过",cancelButtonText:"取消",center:!0}).then(()=>S(this,null,function*(){T({meta_id_list:e,approved:!0}).then(a=>{B.success("审核成功"),x(1)})}))}function I(e){N.confirm("确认数据内容已经无误，是否确认通过？","审核通过",{confirmButtonText:"确认通过",cancelButtonText:"取消",center:!0}).then(()=>S(this,null,function*(){T({meta_id_list:[e.id],approved:!0}).then(a=>{B.success("审核成功"),x(1)})}))}const w=h(""),y=h(!1),$=h();function P(e){$.value=e,y.value=!0,w.value=""}let L=!1;function X(){L=!0,y.value=!0,w.value=""}const Y=()=>{let e=null;L?e=v.map(a=>a.id):e=[$.value.id],T({meta_id_list:e,approved:!1,reason:w.value}).then(a=>{B.success("操作成功"),x(1),y.value=!1})},G=e=>{var a;return console.log(e),(a=_e.find(f=>f.value==e))==null?void 0:a.label},J=e=>{ue.push({name:"checkUserData",query:{id:e.row.id,type:"check"}})};return oe(()=>{i()}),(e,a)=>{const f=c("el-tab-pane"),K=c("el-tabs"),b=c("el-button"),Q=c("el-form-item"),W=c("el-form"),r=c("el-table-column"),Z=c("el-tooltip"),ee=c("el-pagination"),te=c("el-input"),ae=c("el-dialog"),le=se("loading");return V(),q("div",fe,[t(K,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=l=>d.value=l),class:"demo-tabs",onTabClick:p},{default:o(()=>[t(f,{label:"全部",name:"-1"}),t(f,{label:"待审核",name:"0"}),t(f,{label:"已通过",name:"1"}),t(f,{label:"未通过",name:"2"})]),_:1},8,["modelValue"]),t(W,{inline:!0,"label-width":"0"},{default:o(()=>[t(Q,{label:""},{default:o(()=>[t(b,{size:"large",disabled:v.length==0,onClick:H},{default:o(()=>[u(" 批量通过 ")]),_:1},8,["disabled"]),t(b,{size:"large",onClick:X,disabled:v.length==0},{default:o(()=>[u(" 批量拒绝 ")]),_:1},8,["disabled"])]),_:1})]),_:1}),ie((V(),E(R(ce),{onSelectionChange:A,ref_key:"multipleTableRef",ref:_,size:"large",class:"mb-20",data:m,style:{width:"100%"}},{default:o(()=>[t(r,{type:"selection",selectable:F,width:"55"}),t(r,{label:"序号",type:"index",index:1,width:"60",align:"center"}),t(r,{label:"数据名称",prop:"title","show-overflow-tooltip":"",width:"120",align:"center"}),t(r,{label:"摘要","show-overflow-tooltip":"",prop:"abstract",align:"center"}),t(r,{label:"可见范围","show-overflow-tooltip":"",align:"center",width:"150"},{default:o(l=>[u(z(G(l.row.visibility)),1)]),_:1}),t(r,{label:"一级机构",prop:"project_name",width:"150","show-overflow-tooltip":""}),t(r,{label:"二级机构",prop:"subject_name",width:"150","show-overflow-tooltip":""}),t(r,{label:"审核状态",width:"100",align:"center"},{default:o(l=>[l.row.review_state==2?(V(),E(Z,{key:0,placement:"top"},{content:o(()=>[u(z(l.row.disapprove_reason),1)]),default:o(()=>[M("span",ve,z(j(l.row.review_state)),1)]),_:2},1024)):(V(),q("span",{key:1,style:re({color:l.row.review_state==1?"#888888":"#E5A303"})},z(j(l.row.review_state)),5))]),_:1}),t(r,{label:"上传人",prop:"real_name"}),t(r,{label:"上传时间",prop:"time",width:"170"},{default:o(l=>[M("span",null,z(R(me)(new Date(l.row.time),"yyyy-MM-dd hh:mm:ss")),1)]),_:1}),t(r,{label:"操作",width:"200",fixed:"right",align:"center"},{default:o(l=>[t(b,{link:"",size:"small",onClick:U=>J(l)},{default:o(()=>[u(" 查看 ")]),_:2},1032,["onClick"]),t(b,{disabled:l.row.review_state!=0,link:"",type:"primary",size:"small",onClick:U=>I(l.row)},{default:o(()=>[u(" 通过 ")]),_:2},1032,["disabled","onClick"]),t(b,{disabled:l.row.review_state!=0,link:"",type:"danger",size:"small",onClick:U=>P(l.row)},{default:o(()=>[u(" 拒绝 ")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[le,k.value]]),t(ee,{"current-page":n.page,"onUpdate:currentPage":a[1]||(a[1]=l=>n.page=l),"page-size":n.page_size,"onUpdate:pageSize":a[2]||(a[2]=l=>n.page_size=l),"page-sizes":[5,10,15,20],background:"",layout:"->,prev,pager,next,sizes,jumper,total",total:g.value,onSizeChange:C,onCurrentChange:x},null,8,["current-page","page-size","total"]),t(ae,{modal:"","close-on-click-modal":!1,modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=l=>y.value=l),title:"拒绝审核",width:"500"},{footer:o(()=>[M("div",be,[t(b,{size:"large",onClick:a[4]||(a[4]=l=>y.value=!1)},{default:o(()=>[u(" 取消 ")]),_:1}),t(b,{size:"large",type:"primary",disabled:w.value=="",onClick:Y},{default:o(()=>[u(" 确定 ")]),_:1},8,["disabled"])])]),default:o(()=>[M("div",null,[t(te,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=l=>w.value=l),type:"textarea",placeholder:"请输入不通过原因"},null,8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),Ce=de(he,[["__scopeId","data-v-dcb18faa"]]);export{Ce as default};
